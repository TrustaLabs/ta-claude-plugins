---
name: Interactive Planning
description: 当用户在plan模式规划任务时或需要创建详细实施计划时，应使用此 skill。提供结构化的多轮对话以进行全面的计划开发。使用5层次框架深度挖掘需求，MoSCoW矩阵防止跑偏，4维度边界情况矩阵系统化处理边界情况。智能提问机制避免重复问题，只问用户描述中未明确的关键点。触发短语包括："帮我制定计划"、"分步骤实现"、"把这个任务拆解一下"、"我需要做多件事"、"规划一下实现步骤"、"分析需求"、"设计实现方案"、"评估技术方案"、"优化计划"、"完善方案"、"交互式制定计划"。
version: 0.3.0
---

# 交互式计划制定 Skill

## 目的

提供结构化的交互式方法来创建全面的实施计划。通过多轮对话（根据复杂度 3-7 轮），引导用户从初始需求到详细的、可执行的计划，包含风险评估和技术权衡。

## 何时使用

在以下情况下触发此 skill：
- 用户需要规划复杂功能的实现
- 需求在编码前需要澄清
- 存在多种技术方案需要评估
- 架构决策需要讨论
- 用户希望通过反馈循环迭代细化计划

## 执行流程

### 第一步：阅读研究文档

如果用户提供了研究文档或上下文：
1. 完整阅读所有提供的文档
2. 理解当前代码结构和模式
3. 识别需要修改的文件
4. 注意潜在的风险点和依赖关系
5. 提取关键约束和需求

如果未提供文档：
1. 使用 Glob/Grep 探索相关代码库区域
2. 阅读关键文件以理解现有模式
3. 记录发现作为计划基础

### 第二步：创建初始计划

基于研究，创建实施计划的第一版：

1. **需求理解** - 总结需要构建的内容
2. **技术方案** - 提出初始技术方法
3. **实施步骤** - 分解为多个阶段
4. **风险评估** - 识别潜在问题
5. **测试策略** - 概述测试方法

将初始计划草稿保存到 `docs/plans/` 目录，文件名包含时间戳。

### 第三步：交互式迭代（3-5轮）

根据功能复杂度动态调整对话轮数：
- **简单功能**（单一技术方案、低风险、单模块）→ 3轮
- **中等功能**（2-3个技术方案、中等风险、2-3个模块）→ 4轮
- **复杂功能**（多个技术方案、高风险、多模块）→ 5轮

**核心原则：**
1. **智能提问** - 只问用户描述中未明确的问题，避免重复
2. **信息推断** - 从已有信息推断隐含答案，不重复确认
3. **高密度对话** - 使用 AskUserQuestion 一次性提出多个结构化问题
4. **价值导向** - 每个问题都必须能获得新信息，不为问而问

---

#### 第1轮：需求全貌挖掘（15-20分钟）

**提问前的智能分析：**
1. 仔细分析用户的初始描述，识别已明确的信息
2. 识别可从上下文推断的隐含信息
3. 只针对真正不明确的关键点提问

使用**5层次框架**系统化地深度澄清需求：

**第1层：核心目标（Why）**
- 为什么需要这个功能？解决什么问题？
- 这个功能的成功标准是什么？如何衡量？
- 对用户/业务的价值是什么？

**第2层：功能范围（What）**
- 核心功能是什么？
- 哪些是必须实现的（Must Have）？
- 哪些是应该实现的（Should Have）？
- 哪些是可以实现的（Could Have）？
- 明确不做的功能有哪些（Won't Have）？

**第3层：用户体验（How）**
- 用户如何触发这个功能？
- 成功/失败时用户应该看到什么？
- 是否需要加载状态、进度提示、错误提示？
- 是否需要确认对话框或撤销功能？

**第4层：技术约束（Constraints）**
- 性能要求：响应时间？并发量？数据量？
- 安全要求：涉及敏感数据？需要加密？
- 兼容性：支持哪些浏览器/设备？
- 依赖限制：必须使用特定库？

**第5层：边界情况（Edge Cases）**
- 网络请求失败怎么办？
- 数据不存在怎么办？
- 用户权限不足怎么办？
- 并发冲突怎么办？
- 用户输入无效数据怎么办？

**智能提问规则：**
- ✅ 如果用户说"添加用户认证"，推断需要登录/注册/密码重置，不再问"需要哪些功能"
- ✅ 如果用户说"实现深色模式"，推断需要主题切换，不再问"用户如何触发"
- ✅ 如果用户说"优化性能"，推断需要性能指标，直接问具体优化目标
- ❌ 不要问用户已经明确说明的内容
- ❌ 不要问可以从常识推断的内容（如"深色模式需要切换按钮吗？"）
- ❌ 不要问与功能无关的通用问题（如"需要错误处理吗？"）

**范围确认（第1轮延续）**

基于用户回答，使用 **MoSCoW 矩阵**明确范围：

```markdown
**Must Have（必须实现）**
- [ ] 功能1 - 理由：核心价值
- [ ] 功能2 - 理由：用户必需

**Should Have（应该实现）**
- [ ] 功能3 - 理由：重要但非关键

**Could Have（可以实现）**
- [ ] 功能4 - 理由：锦上添花

**Won't Have（不实现）**
- [ ] 功能5 - 理由：超出范围
```

**检查点：** 使用 AskUserQuestion 确认用户同意此范围划分。

**输出：** 需求概述 + MoSCoW 范围矩阵

---

#### 第2轮：方案设计与细化（20-30分钟）

**技术方案评估**（如有多个方案）
- 候选技术方案对比
- 各方案的优缺点分析
- 性能/安全/可维护性权衡
- 推荐方案和理由

**实施步骤分解**
- 将计划分解为具体阶段
- 每个阶段的具体任务（包含文件路径）
- 任务之间的依赖关系
- 可并行执行的任务
- 每个任务的复杂度评估

**边界情况矩阵**（系统化处理）

使用4维度矩阵系统化地识别和处理边界情况：

| 维度 | 场景 | 触发条件 | 处理方案 | 测试用例 | 优先级 |
|------|------|---------|---------|---------|--------|
| **数据** | 数据为空 | 查询返回 null | 显示占位符 | test_empty_data | 高 |
| **数据** | 数据超大 | 数据量 >10000 | 分页加载 | test_large_data | 中 |
| **网络** | 网络超时 | 请求 >10s | 重试3次 | test_timeout | 高 |
| **网络** | 服务器错误 | 5xx 响应 | 显示错误提示 | test_server_error | 高 |
| **并发** | 重复提交 | 快速点击 | 防抖/节流 | test_duplicate_submit | 高 |
| **权限** | Token过期 | Token失效 | 自动刷新 | test_token_expired | 高 |

**检查点：** 使用 AskUserQuestion 确认用户同意技术方案。

**输出：** 技术方案 + 实施步骤 + 边界情况处理

---

#### 第3轮：风险测试与最终审查（15-20分钟）

**风险评估**
- 技术风险识别和缓解措施
- 依赖风险识别和缓解措施
- 性能/安全风险识别和缓解措施

**测试策略**
- 单元测试：覆盖率目标、测试重点
- 集成测试：关键流程、测试场景
- E2E 测试：关键路径、测试环境

**最终完整性检查**
- [ ] 所有需求都有对应实施步骤
- [ ] 所有风险都有缓解措施
- [ ] 所有边界情况都有处理方案
- [ ] 测试策略覆盖所有关键路径
- [ ] 实施顺序合理，无循环依赖

**检查点：** 使用 AskUserQuestion 获取用户最终批准。

**输出：** 完整的实施计划文档

---

#### 扩展流程（复杂功能5轮）

当功能复杂时（多个技术方案、高风险、多模块），可将第2轮拆分为独立的轮次：

**第1轮：** 需求全貌挖掘（同上）
**第2轮：** 技术方案评估（独立讨论技术权衡）
**第3轮：** 实施路径规划（详细任务分解）
**第4轮：** 风险和边界情况（系统化分析）
**第5轮：** 测试策略与最终审查

### 第四步：输出计划文档

将最终计划保存到 `docs/plans/` 目录，结构如下：

```markdown
# [功能名称] 实施计划

**创建时间：** [时间戳]
**状态：** 已批准
**复杂度：** [简单/中等/复杂]

## 1. 需求概述
[需求摘要]

## 2. 技术方案
[选定的技术方法及理由]

## 3. 实施步骤
### 阶段 1：[名称]
- [ ] 任务 1 (文件: path/to/file.ts:line)
- [ ] 任务 2 (文件: path/to/file.ts:line)

### 阶段 2：[名称]
...

## 4. 风险评估
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| ... | ... | ... |

## 5. 测试策略
- 单元测试：[覆盖率目标]
- 集成测试：[关键流程]
- E2E 测试：[关键路径]

## 6. 技术权衡
[做出的决策和考虑的替代方案]

## 7. 回滚计划
[如果需要如何回滚]
```

## 使用支持文件

### 参考文件

详细的计划方法论：
- **`references/planning-best-practices.md`** - 全面的计划技术、风险评估框架和迭代细化策略

### 示例文件

`examples/` 中的工作模板和实战示例：
- **`examples/plan-template.md`** - 包含所有部分的完整计划文档模板
- **`examples/simple-feature.md`** - 简单功能（重置密码）的完整 3 轮交互示例
- **`examples/complex-refactoring.md`** - 复杂重构项目（Redux 迁移）的完整 5 轮交互示例

## 关键原则

1. **渐进式细化** - 从宽泛开始，迭代细化
2. **用户参与** - 让用户参与关键决策
3. **文档驱动** - 在整个过程中维护书面计划
4. **风险意识** - 尽早识别和缓解风险
5. **可执行性** - 每个步骤都必须可操作
6. **灵活调整** - 根据复杂度调整轮数

## 输出位置

所有计划保存到：`docs/plans/[功能名称]-[时间戳].md`

如果目录不存在则创建：
```bash
mkdir -p docs/plans
```
